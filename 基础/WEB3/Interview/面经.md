

## 面经
[Solana](Solana.md)

## L2概念

[L0 L1 L2](../Base/Mantle-Network/Mantle-Network.md)
- **Layer 0**是数据传输层，指的就是区块链最基础的底层协议，也就是节点之间传递讯息的通讯层，负责基础的数据传递及建立共识达成效率。
- **Layer 1**是底层区块链。比特币(BTC)、以太坊(ETH)、币安智能链(BNB)和Solana都属于Layer-1协议。
- **Layer2**又称链下扩容，指不改变区块链底层协议和基础规则，通过状态通道、侧链，乐观卷积，zk，等方案提高交易处理速度。
- **Layer3**指的是应用层。 DAO， DID

## 跨链

[跨链](../Base/Mantle-Network/Mantle-Network.md#^94e5dc)



## MEV 最大可提取价值 && 优先费
> (Maximum Extractable Value)

优先费：Compute Units，还有一个limit

在 DeFi、NFT Mint 等高竞争场景下，如何合理设置优先费
- **先模拟交易，查看所需的 Compute Units（CU）**，以便估算合理的优先费。
- **观察当前网络的平均优先费水平**，比如可以通过 Solana 区块浏览器或 RPC 获取数据。

| **工具**            | **用途**                                    |
| ----------------- | ----------------------------------------- |
| **NextBlock**     | 用于 **优化区块构建**，提高交易排序优先级                   |
| **Jito**          | 提供 **MEV 交易打包（Jito Bundle）**，支持 **优先费用**  |
| **Priority Fees** | 允许用户 **支付更高的 Compute Units 费用**，提高交易执行优先级 |
| **MEV**           | 通过 **交易排序控制** 提取额外价值，如套利、清算等              |

- 通过 **ComputeBudgetProgram** 手动提高 **Compute Unit 费用** ✅
- 使用 **Jito-Solana** 发送 **Jito Bundles** ✅
- 运行 **NextBlock** 提高 **交易排序优先级** ✅


## LUT    ALT地址查找表
> 1、先解释v0，-> message是含有地址查找表-> 作用，-> 本公司的multiple call

| **LUT 用途**  | **Ethereum（EVM）**  | **Solana**       |
| ----------- | ------------------ | ---------------- |
| **优化计算**    | 预计算数学/哈希值，加速智能合约   | 不适用              |
| **Gas 费优化** | 使用 `mapping` 作为查找表 | 通过 LUT 减少交易大小    |
| **地址管理**    | 依赖合约内存储            | 使用 LUT 存储和复用账户地址 |
| **交易优化**    | 通过数据存储减少计算         | 降低账户管理成本，提高交易吞吐量 |


## 安全
[合约安全漏洞](../Base/合约安全漏洞/合约安全漏洞.md)


## 降低gas

[EVM](../Base/WEB3Base/WEB3Base.md#^b9d849)

[Solana](../Base/Solana/Solana.md#^72f9e0)
[solana的cu减少总结](./Solana.md#^e428ca)
> 组成：
> 计算资源，存储（读写）/内存资源，交易资源，外部调用（内部调用），指令大小
> 三个层面：
> 1、代码层面： 减少读写，减少合约逻辑，, 减少cpi跨合约调用，避免无关账户的传递
> 2、合约交互层面：地址查找表，网络状态，mutiple call，序列化
> 3、人工交流层面：减少参数，或者合并参数

[CU](Solana.md#^6b5e24)

计算单元（CU）是 **衡量 Solana 交易计算成本的单位**，类似以太坊的 Gas。Solana 交易执行时，每个智能合约指令（Instruction）都会消耗 CU。

- 每个区块的 CU 限制：**最大 12.5 亿 CU**
- 默认交易 CU 限制：**200,000 CU**
- 超过默认 CU 需要 **手动提升上限**

## NFT


[NFT 常见的协议 || ERC](Solana.md#^91929f)
> EIP是一个标准：如[EIP712类型化数据签名](https://eips.ethereum.org/EIPS/eip-712)是一种更高级、更安全的签名方法。当支持 EIP712 的 Dapp 请求签名时，钱包会展示签名消息的原始数据，用户可以在验证数据符合预期之后签名。


## 项目

[amm](amm.md)

- 计算LP的数量，`sqrt(amount_x * amount_y)`
- **Solana 上的流动性池需要最小 LP 代币锁定**（`MINIMUM_LIQUIDITY`），防止流动性池因存款极小而造成计算误差。`amount_lp -= MINIMUM_LIQUIDITY`

- **swap**获取输出币的数量**恒定乘积公式 x×y=k** 计算输出： $${output} = \frac{\text{taxed\_input} \times \text{pool\_B}}{\text{pool\_A} + \text{taxed\_input}} $$其中：
    - `pool_A` 和 `pool_B` 分别是池子中的两种代币数量。
    - `taxed_input` 是扣除手续费后的输入代币数量。

- `output < min_output_amount` 这里用于 **滑点保护**，如果 `output` **小于** `min_output_amount`，则交易失败，避免用户亏损。如果滑点过大，可能会被套利者利用进行三明治攻击（Sandwich Attack）。
- 计算交易前的乘积不变量， 最后要做一个不变量进行一个验证。[不变量](amm.md#^97e075)
- 提取的时候要加一个最小  LP代币。防止用户一次性把池子里的所有资产提取走，导致池子归零。
**滑点作用：**
- **保护交易者**：避免因为池子深度问题或价格剧烈波动而导致的糟糕成交价格。
- **防止 MEV（最大可提取价值）攻击**：如果滑点过大，可能会被套利者利用进行三明治攻击（Sandwich Attack）。
- **提高交易确定性**：用户可以通过 `min_output_amount` 控制自己愿意接受的最差成交价格。

**如何增加流动性和滑点：**

**流动性：**
- v3的集中化流动性
- 增加动态手续费
- 增加交易深度，到了一定程度增加池子币量
**滑点：**
滑点（Slippage）是指 **交易预期价格与实际成交价格的偏差**，主要由 **流动性深度** 和 **交易规模** 影响。
- 通过 **限价订单** 设定最小接受价格，避免因市场波动导致高滑点。

## Defi  Uniswap1 2 3

[Defi](Solana.md#^cad198)


| **算法**                 | **适用场景**         | **优点**     | **缺点**      |
| ---------------------- | ---------------- | ---------- | ----------- |
| **恒定乘积做市商（AMM）**       | DEX（Uniswap）     | 低 Gas、无订单簿 | 滑点高，价格偏离    |
| **订单簿模式**              | 高流动性市场（Serum）    | 精确定价       | 需要 LP 提供流动性 |
| **预言机定价**              | 合成资产、借贷协议        | 准确         | 依赖外部数据      |
| **NFT 报价（AMM + 机器学习）** | NFT 交易（Sudoswap） | 自动化定价      | 适应性低        |
| **机器学习**               | 预测价格             | 动态调整       | 训练成本高       |

[Uniswap 优势](Solana.md#^c186e2)

| **特性**       | **V1**                    | **V2**              | **V3**                |
| ------------ | ------------------------- | ------------------- | --------------------- |
| **流动性池**     | ETH-Token                 | 任意 ERC-20 交易对       | 集中流动性（CLMM）           |
| **定价公式**     | 恒定乘积公式 x⋅y=kx \cdot y = k | 同 V1                | 采用 Tick-based 机制优化流动性 |
| **交易路径**     | 仅支持 Token 与 ETH 交换        | 直接支持 Token-Token 交易 | 同 V2                  |
| **价格预言机**    | 无                         | TWAP 预言机            | 低 Gas 成本的 TWAP        |
| **LP 资金效率**  | 低                         | 较高                  | 最高（LP 选择流动性区间，提高资本效率） |
| **手续费模式**    | 固定 0.3%                   | 可变 0.05% - 1%       | 多档费率，LP 自定义           |
| **闪电贷**      | 无                         | 支持                  | 支持                    |
| **NFT 化流动性** | 无                         | 无                   | 是（LP 头寸是 NFT）         |
> **TWAP（Time-Weighted Average Price）预言机** 是一种基于 **时间加权平均价格** 的 **去中心化预言机**，用于提供某个资产在一段时间内的平均价格，以减少短期价格波动对交易的影响。TWAP 预言机能够平滑价格波动, 使得攻击者很难通过短时间操纵价格获利。

## MPL

| **模块 (Module)**                | **功能 (Functionality)**                                     | **适用场景 (Use Case)**                          |
| ------------------------------ | ---------------------------------------------------------- | -------------------------------------------- |
| **Bubblegum（泡泡糖）**             | 通过 **Merkle Tree** 结构减少存储成本，压缩 NFT（Compressed NFTs），降低存储成本 | 适用于游戏资产、大规模 NFT 发行                           |
| **Core（核心）**                   | 新一代 NFT 标准                                                 | 扩展了 Token Metadata，增强兼容性和可扩展性。               |
| **Fusion（融合）**                 | NFT 嵌套 NFT，允许 NFT 作为另一个 NFT 的一部分，支持复杂的 NFT 组合。             | 如游戏角色装备系统。                                   |
| **Inscription（铭刻）**            | Solana 上的 NFT 刻写                                           | 允许将数据永久刻写到 Solana 链上，提升不可篡改性。，类似比特币 Ordinals |
| **Token Metadata（代币元数据）**      | NFT 元数据标准，定义 NFT 的名称、图片、属性、授权等信息。                          | NFT 交易市场、艺术品收藏                               |
| **Candy Machine（糖果机）**         | NFT 发行工具（Launchpad）                                        | 公平铸造（Fair Mint）、白名单销售                        |
| **Core Candy Machine（核心糖果机）**  | 数字资产发行工具                                                   | Candy Machine 的升级版，支持更多类型的数字资产，不仅限于 NFT      |
| **Token Auth Rules（代币授权规则）**   | NFT 权限管理                                                   | 允许 NFT 设定访问规则，如**仅特定地址可转移**，增强安全性            |
| **Hydra（九头蛇）** - **Fanout 钱包** | Fanout 钱包（收益分配）允许多个用户共享一个钱包。                               | 适用于**DAO 分红、收益分享、NFT 版税**等场景。                |
| **MPL-Hybrid（混合资产）**           | 允许 NFT 和 FT（可替代代币，如 SOL、USDC）组合。                           | 创建**半同质化代币（SFT）**，如游戏道具、门票等。                 |


## Ed25519 算法 签名

[ed25519算法](../Anchor/Anchor.md#^8c34df)
**Ed25519** 是一种 **椭圆曲线数字签名算法（EdDSA）**，基于 **Curve25519 椭圆曲线**，提供 **高安全性** 和 **高性能**，广泛用于 **Solana、Stellar、Polkadot、Tor** 等 Web3 项目。

在 Solana 里，**所有账户（包括用户钱包、合约地址、PDA）都基于 Ed25519 生成公私钥对**，用于签名交易、身份认证等。


| 区块链          | 签名算法              | 地址计算                 | 额外哈希 | 钱包签名              | 交易签名                   |
| ------------ | ----------------- | -------------------- | ---- | ----------------- | ---------------------- |
| **Ethereum** | ECDSA (secp256k1) | Keccak256(公钥后 20 字节) | ✅    | EIP-191 / EIP-712 | RLP 编码后 Keccak256 签名   |
| **Solana**   | Ed25519           | Base58(公钥)           | ❌    | 直接签名消息            | 直接签名交易消息（包含 blockhash） |
| **TON**      | Ed25519           | 哈希+额外信息              | ✅    | 直接签名数据            | 直接签名交易消息               |
| **Sui**      | Ed25519 + Blake2b | Blake2b(公钥) 取前 20 字节 | ✅    | Sui 标准签名格式        | BCS 序列化后签名             |








## Other
1、rust内存模型（1. **所有权 (Ownership)**，2. **借用 (Borrowing)**，3. **生命周期 (Lifetimes)**，4. **栈和堆 (Stack and Heap)**，5. **并发和原子性**）
2、扫块多线程优化方式：整合一个拿队列进行保存入库。
3、gas组成（Gas Fee = Gas Used * Gas Price，Gas 可以分为两个主要组成部分：**Gas Limit** 和 **Gas Price**。）
- **基础费用（Intrinsic Gas Cost）**：与交易的基本数据（如签名、接收者地址等）相关的固定成本。每笔交易都有最低的 21,000 gas 作为基础费用。
- **执行成本（Execution Gas Cost）**：与实际执行的操作有关，比如存储、计算等。智能合约的每个操作（如存储写入、函数调用、循环等）都有特定的 gas 消耗。
4、layer2是什么，layer1和layer2如何通信（状态通道）
5、双花问题
6、[区块链｜ 期望35K｜腾讯2轮面经，感觉区块链方向一点都不卷 (qq.com)](https://mp.weixin.qq.com/s/21_WEWEprfP7BEWZ9rrhwQ)
7、Mev问题（三明治攻击等等）
8、入库的事务如何处理。
9、对于solana的账户数据泄露（猜数游戏）
10、如何节约gas




#### defi/nft相关协议
| **类别**       | **协议（Ethereum）**   | **协议（Solana）**     |
| ------------ | ------------------ | ------------------ |
| **DEX（交易所）** | Uniswap, SushiSwap | Raydium, Orca      |
| **借贷**       | Aave, Compound     | Solend             |
| **衍生品**      | dYdX               | Mango Markets      |
| **稳定币**      | DAI, USDC          | USDC               |
| **资产管理**     | Yearn Finance      | Jupiter            |
| **NFT 交易市场** | OpenSea, Blur      | Magic Eden, Tensor |
| **NFT 借贷**   | BendDAO, NFTfi     | Sharky.fi          |
| **NFT 碎片化**  | Fractional.art     | -                  |
| **NFT 发行**   | Manifold           | Metaplex           |


| **链**        | **协议/标准**               | **特点**                | **示例**                |
| ------------ | ----------------------- | --------------------- | --------------------- |
| **Ethereum** | ERC-721                 | 单一 NFT 标准             | CryptoPunks, BAYC     |
|              | ERC-1155                | 可同时支持 FT & NFT，减少 Gas | Enjin, Gods Unchained |
|              | ERC-2981                | NFT 版税标准              | OpenSea, LooksRare    |
| **Solana**   | Metaplex Token Metadata | Solana 主要 NFT 标准      | Okay Bears, DeGods    |
|              | Compressed NFTs (cNFTs) | 适合大规模 NFT 发行，存储优化     | Tensor Market, DRiP   |
| **Sui**      | Move NFT                | 基于 Move 语言，对象化存储      | Sui Kiosk             |
| **TON**      | TON NFT                 | 适用于 Telegram 生态       | TON DNS               |

#### 报价算法

**区块链报价算法**（Pricing Algorithm）指的是在去中心化交易市场（DEX）、跨链桥、借贷市场、NFT 交易平台等场景中，**确定资产价格的计算方法**。报价算法的核心目标是：

1. **保证公平性**：价格不能被操纵或恶意偏离市场价格。
2. **提高流动性**：在低滑点的前提下，确保足够的成交量。
3. **抗 MEV 攻击**：防止抢跑、三明治攻击等恶意操作。

区块链上的报价方式可以分为 **链上（On-Chain）** 和 **链下（Off-Chain）** 两类：

- **链上报价**：由智能合约计算价格，如 Uniswap V2/V3、Curve。
- **链下报价**：由预言机（Oracle）提供，如 Chainlink、Pyth、TWAP（时间加权平均价格）。

[报价算法](Solana.md#^c68b26)

| **类型**                    | **适用场景**          | **示例协议**                        |
| ------------------------- | ----------------- | ------------------------------- |
| **AMM（自动做市商）**            | DeFi DEX（去中心化交易所） | Uniswap、Sushiswap、Curve、Raydium |
| **订单簿（Order Book）**       | DeFi 交易、NFT 交易    | Serum、dYdX、NFT 市场               |
| **预言机定价（Oracles）**        | DeFi 贷款、合成资产      | Chainlink、Pyth、Switchboard      |
| **拍卖定价（Auction Pricing）** | NFT 交易、IDO、MEV 竞拍 | OpenSea、Magic Eden、Seaport      |
| **指数定价（Index Pricing）**   | ETF、指数基金          | NFTX、Synthetix、Balancer         |






Miner 是从什么方式获取到待打包的 Transactions? 
Miner 是基于什么样策略从 Transaction Pool 中选择 Transaction 呢？
被选择的 Transactions 又是以怎样的顺序(Order)被打包到区块中的呢？
在执行 Transaction 的 EVM 是怎么计算 gas used，从而限定 Block 中 Transaction 的数量?
剩余的 gas 又是怎么返还给 Transaction Proposer 的呢？
EVM 是怎么解释 Contract Code 的 Message Call 并执行的呢？
在执行 Transaction 时，是什么模块，怎样去修改 Contract 中持久化变量？
Smart Contract 中的持久化变量是以什么样的形式存储？又是存储在什么地方？
当新的 Block 更新到 Blockchain 中时，World State 又是在什么时机，以什么方式更新的呢？
哪些数据常驻内存，哪些数据需要保存在 Disk 中呢？