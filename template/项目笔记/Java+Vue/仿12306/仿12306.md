# 1 介绍

## 1.1 架构介绍

![image-20240307210838911](./assets/image-20240307210838911.png)

> 城市、车站、车次写入基础数据DB



## 1.2 技术栈

总体架构： Springboot2.x + maven + JDK8 + Mysql

基础组件：Mybatis + Guava + Jackson + lombok

中间件：Redis + elasticsearch + canal + sharding-jdbc + rabbitmq



## 1.3 整体介绍

> 最简化可视性版本
>
> 不是仿照12306网站做出来一个，而是基于这个实际的复杂业务场景，进行分析，拆解，开发，并结合它的高并发特性做一些高可用架构设计和讲解。



**功能**：

train相关实体管理，生成座位，放票，查询余票，抢票，生成订单。

**不做的功能**：

登录， 个人信息管理，实际支付和退款，不影响整体流程的功能，候补等一些特殊逻辑。

**内容**：

需求设计，数据库设计，项目搭建，流行的设计思想，后台管理实现，前台查余票及购买，组件使用及实践。





## 1.4 需求分析分解

### 1.4.1 购票分解：

1. 城市、车站、出发日期、座位、查询余票
2. 车次、车次详情、时间、时长、座位等级
3. 车次、车站、时间、座位、乘客
4. 车次、车站、实际座位、支付信息、支付/取消 

总：城市、车站、车次、车次详情、座位等级、实际座位、时间、时长、乘客、支付信息。



### 1.4.2 业务实体类：

- 城市·TrainCity
- 车站·TrainStation
- 车次·TrainNumber
- 车次详情·TrainNumberDetail
- 座位·TrainSeat
- 乘客·TrainTraveller
- 用户·TrainUser
- 订单详情·TrainOrderDetail
- 订单·TrainOrder



### 1.4.3 核心流程说明：

基础数据准备：

> 城市管理->车站管理->车次管理->车次详情管理

管理员日常运维：

> **生成“车票”、搜索车票**->放票

用户操作：

> **查询指定日期车票(车次及余票)->提交订单(抢票)**->查看/支付/取消->维护乘客信息

### 1.4.4 任务拆解与业务介绍-基础数据管理

- 城市管理

  - 新增城市
  - 更新城市
  - 查询城市

- 车站管理

  - 新增车站
  - 更新车站
  - 查询车站

- 动车车次属性

  - 动车类型
    - CR2
    - CR5

  - 座位等级
    - 商务座
    - 一等座
    - 二等座
  - 座位价钱
    - 成人价
    - 学生价

- 车次管理
  - 车型及座位维护
  - 新增车次  数据写入es
  - 更新车次  数据更新es
  - 查询车次

- 车次详情管理
  - 新增车次详情
  - 删除车次详情
  - 车次详情列表查询
  - 根据车次id查车次详情列表

> 这里没有更新车次详情，利用删除和新增代替更新。

## 分库分表



## 高并发



## 高性能



## 高可用

